// Rich text editor -  Pagedown http://code.google.com/p/pagedown/
// Converter
var Markdown;Markdown="object"===typeof exports&&"function"===typeof require?exports:{};(function(){function q(e){return e}function s(){return!1}function t(){}function u(){}t.prototype={chain:function(e,h){var i=this[e];if(!i)throw Error("unknown hook "+e);this[e]=i===q?h:function(e){return h(i(e))}},set:function(e,h){if(!this[e])throw Error("unknown hook "+e);this[e]=h},addNoop:function(e){this[e]=q},addFalse:function(e){this[e]=s}};Markdown.HookCollection=t;u.prototype={set:function(e,h){this["s_"+e]=h},get:function(e){return this["s_"+e]}};Markdown.Converter=function(){function e(a){return a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(a,c,b,g,e,j){c=c.toLowerCase();k.set(c,A(b));if(e)return g;j&&l.set(c,j.replace(/"/g,"&quot;"));return""})}function h(a){a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,i);a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,i);a=a.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,i);a=a.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,i);return a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,i)}function i(a,d){var c;c=d.replace(/^\n+/,"");c=c.replace(/\n+$/g,"");return c="\n\n~K"+(o.push(c)-1)+"K\n\n"}function v(a,d){a=s(a);a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,"<hr />\n");a=a.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,"<hr />\n");a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,"<hr />\n");a=B(a);a=G(a);a=H(a);a=h(a);return a=I(a,d)}function p(a){a=J(a);a=q(a);a=a.replace(/\\(\\)/g,w);a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,w);a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,C);a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,C);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,x);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,x);a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,x);a=K(a);a=a.replace(/~P/g,"://");a=A(a);a=a.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4");a=a.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4");return a=a.replace(/  +\n/g," <br>\n")}function q(a){return a=a.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi,function(a){var c=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return c=m(c,"!"==a.charAt(1)?"\\`*_/":"\\`*_")})}function x(a,d,c,b,g,e,j,f){void 0==f&&(f="");a=c.replace(/:\/\//g,"~P");b=b.toLowerCase();if(""==g)if(""==b&&(b=a.toLowerCase().replace(/ ?\n/g," ")),void 0!=k.get(b))g=k.get(b),void 0!=l.get(b)&&(f=l.get(b));else if(-1<d.search(/\(\s*\)$/m))g="";else return d;g=L(g);g=m(g,"*_");d='<a href="'+g+'"';""!=f&&(f=y(f),f=m(f,"*_"),d+=' title="'+f+'"');return d+(">"+a+"</a>")}function y(a){return a.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function C(a,d,c,b,g,e,j,f){a=c;b=b.toLowerCase();f||(f="");if(""==g)if(""==b&&(b=a.toLowerCase().replace(/ ?\n/g," ")),void 0!=k.get(b))g=k.get(b),void 0!=l.get(b)&&(f=l.get(b));else return d;a=m(y(a),"*_[]()");g=m(g,"*_");d='<img src="'+g+'" alt="'+a+'"';f=y(f);f=m(f,"*_");return d+(' title="'+f+'"')+" />"}function s(a){a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,c){return"<h1>"+p(c)+"</h1>\n\n"});a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,c){return"<h2>"+p(c)+"</h2>\n\n"});return a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,c,b){a=c.length;return"<h"+a+">"+p(b)+"</h"+a+">\n\n"})}function B(a){var a=a+"~0",d=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;r?a=a.replace(d,function(a,b,d){a=-1<d.search(/[*+-]/g)?"ul":"ol";b=D(b,a);b=b.replace(/\s+$/,"");return"<"+a+">"+b+"</"+a+">\n"}):(d=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(d,function(a,b,d,e){a=-1<e.search(/[*+-]/g)?"ul":"ol";d=D(d,a);return b+"<"+a+">\n"+d+"</"+a+">\n"}));return a=a.replace(/~0/,"")}function D(a,d){r++;var a=a.replace(/\n{2,}$/,"\n"),c=M[d],b=!1,a=(a+"~0").replace(RegExp("(^[ \\t]*)("+c+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+c+")[ \\t]+))","gm"),function(a,d,c,f){a=f;(d=/\n\n$/.test(a))||-1<a.search(/\n{2,}/)||b?a=v(z(a),!0):(a=B(z(a)),a=a.replace(/\n$/,""),a=p(a));b=d;return"<li>"+a+"</li>\n"}),a=a.replace(/~0/g,"");r--;return a}function G(a){a=(a+"~0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,c,b){a=E(z(c));a=F(a);a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");return"\n\n"+("<pre><code>"+a+"\n</code></pre>")+"\n\n"+b});return a=a.replace(/~0/,"")}function N(a){a=a.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(o.push(a)-1)+"K\n\n"}function J(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,c,b,e){a=e.replace(/^([ \t]*)/g,"");a=a.replace(/[ \t]*$/g,"");a=E(a);a=a.replace(/:\/\//g,"~P");return c+"<code>"+a+"</code>"})}function E(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");return a=m(a,"*_{}[]\\",!1)}function H(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,c){var b;b=c.replace(/^[ \t]*>[ \t]?/gm,"~0");b=b.replace(/~0/g,"");b=b.replace(/^[ \t]+$/gm,"");b=v(b);b=b.replace(/(^|\n)/g,"$1  ");b=b.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c;c=b.replace(/^  /mg,"~0");return c=c.replace(/~0/g,"")});return N("<blockquote>\n"+b+"\n</blockquote>")})}function I(a,d){for(var a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,""),c=a.split(/\n{2,}/g),b=[],e=/~K(\d+)K/,h=c.length,j=0;j<h;j++){var f=c[j];e.test(f)?b.push(f):/\S/.test(f)&&(f=p(f),f=f.replace(/^([ \t]*)/g,"<p>"),f+="</p>",b.push(f))}if(!d){h=b.length;for(j=0;j<h;j++)for(var i=!0;i;)i=!1,b[j]=b[j].replace(/~K(\d+)K/g,function(a,b){i=!0;return o[b]})}return b.join("\n\n")}function A(a){a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");return a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")}function K(a){a=a.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");return a=a.replace(/<((https?|ftp):[^'">\s]+)>/gi,function(a,c){return'<a href="'+c+'">'+n.plainLinkText(c)+"</a>"})}function O(a){return a=a.replace(/~E(\d+)E/g,function(a,c){var b=parseInt(c);return String.fromCharCode(b)})}function z(a){a=a.replace(/^(\t|[ ]{1,4})/gm,"~0");return a=a.replace(/~0/g,"")}function F(a){if(!/\t/.test(a))return a;var d=["    ","   ","  "," "],c=0,b;return a.replace(/[\n\t]/g,function(a,e){if("\n"===a)return c=e+1,a;b=(e-c)%4;c=e+1;return d[b]})}function L(a){if(!a)return"";var d=a.length;return a.replace(P,function(c,b){return"~D"==c?"%24":":"==c&&(b==d-1||/[0-9\/]/.test(a.charAt(b+1)))?":":"%"+c.charCodeAt(0).toString(16)})}function m(a,d,c){d="(["+d.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);return a=a.replace(RegExp(d,"g"),w)}function w(a,d){return"~E"+d.charCodeAt(0)+"E"}var n=this.hooks=new t;n.addNoop("plainLinkText");n.addNoop("preConversion");n.addNoop("postConversion");var k,l,o,r;this.makeHtml=function(a){if(k)throw Error("Recursive call to converter.makeHtml");k=new u;l=new u;o=[];r=0;a=n.preConversion(a);a=a.replace(/~/g,"~T");a=a.replace(/\$/g,"~D");a=a.replace(/\r\n/g,"\n");a=a.replace(/\r/g,"\n");a=F("\n\n"+a+"\n\n");a=a.replace(/^[ \t]+$/mg,"");a=h(a);a=e(a);a=v(a);a=O(a);a=a.replace(/~D/g,"$$");a=a.replace(/~T/g,"~");a=n.postConversion(a);o=l=k=null;return a};var M={ol:"\\d+[.]",ul:"[*+-]"},P=/(?:["'*()[\]:]|~D)/g}})();
// Sanititzer
(function(){function l(a){return a.replace(/<[^>]*>?/gi,m)}function m(a){return a.match(n)||a.match(o)||a.match(p)?a:""}function q(a){if(""==a)return"";var d=/<\/?\w+[^>]*(\s|$|>)/g,f=a.toLowerCase().match(d),e=(f||[]).length;if(0==e)return a;for(var h,c,g,i=[],j=[],k=!1,b=0;b<e;b++)if(h=f[b].replace(/<\/?(\w+).*/,"$1"),!(i[b]||-1<"<p><img><br><li><hr>".search("<"+h+">"))){c=f[b];g=-1;if(!/^<\//.test(c))for(c=b+1;c<e;c++)if(!i[c]&&f[c]=="</"+h+">"){g=c;break}-1==g?k=j[b]=!0:i[g]=!0}if(!k)return a;b=0;return a=a.replace(d,function(a){a=j[b]?"":a;b++;return a})}var d,e;"object"===typeof exports&&"function"===typeof require?(d=exports,e=require("./Markdown.Converter").Converter):(d=window.Markdown,e=d.Converter);d.getSanitizingConverter=function(){var a=new e;a.hooks.chain("postConversion",l);a.hooks.chain("postConversion",q);return a};var n=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,o=/^(<a\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,p=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i})();
// Editor
(function(){var u,C,w;function v(){}function E(a){this.buttonBar=e.getElementById("wmd-button-bar"+a);this.preview=e.getElementById("wmd-preview"+a);this.input=e.getElementById("wmd-input"+a)}function F(a,c){var d=this,b=[],f=0,g="none",i,e,n,h=function(a,c){g!=a&&(g=a,c||r());!u||"moving"!=g?e=setTimeout(o,1):n=null},o=function(a){n=new A(c,a);e=void 0};this.setCommandMode=function(){g="command";r();e=setTimeout(o,0)};this.canUndo=function(){return 1<f};this.canRedo=function(){return b[f+1]?!0:!1};this.undo=function(){d.canUndo()&&(i?(i.restore(),i=null):(b[f]=new A(c),b[--f].restore(),a&&a()));g="none";c.input.focus();o()};this.redo=function(){d.canRedo()&&(b[++f].restore(),a&&a());g="none";c.input.focus();o()};var r=function(){var d=n||new A(c);if(!d)return!1;"moving"==g?i||(i=d):(i&&(b[f-1].text!=i.text&&(b[f++]=i),i=null),b[f++]=d,b[f+1]=null,a&&a())},l=function(a){var c=!1;if(a.ctrlKey||a.metaKey)switch(String.fromCharCode(a.charCode||a.keyCode)){case "y":d.redo();c=!0;break;case "z":a.shiftKey?d.redo():d.undo(),c=!0}c&&(a.preventDefault&&a.preventDefault(),window.event&&(window.event.returnValue=!1))},m=function(a){!a.ctrlKey&&!a.metaKey&&(a=a.keyCode,33<=a&&40>=a||63232<=a&&63235>=a?h("moving"):8==a||46==a||127==a?h("deleting"):13==a?h("newlines"):27==a?h("escape"):(16>a||20<a)&&91!=a&&h("typing"))};(function(){k.addEvent(c.input,"keypress",function(a){(a.ctrlKey||a.metaKey)&&(89==a.keyCode||90==a.keyCode)&&a.preventDefault()});var a=function(){if((u||n&&n.text!=c.input.value)&&void 0==e)g="paste",r(),o()};k.addEvent(c.input,"keydown",l);k.addEvent(c.input,"keydown",m);k.addEvent(c.input,"mousedown",function(){h("moving")});c.input.onpaste=a;c.input.ondrop=a})();o(!0);r()}function A(a,c){var d=this,b=a.input;this.init=function(){if(k.isVisible(b)&&(c||!(e.activeElement&&e.activeElement!==b)))if(this.setInputAreaSelectionStartEnd(),this.scrollTop=b.scrollTop,!this.text&&b.selectionStart||0===b.selectionStart)this.text=b.value};this.setInputAreaSelection=function(){if(k.isVisible(b))if(void 0!==b.selectionStart&&!C)b.focus(),b.selectionStart=d.start,b.selectionEnd=d.end,b.scrollTop=d.scrollTop;else if(e.selection&&!(e.activeElement&&e.activeElement!==b)){b.focus();var a=b.createTextRange();a.moveStart("character",-b.value.length);a.moveEnd("character",-b.value.length);a.moveEnd("character",d.end);a.moveStart("character",d.start);a.select()}};this.setInputAreaSelectionStartEnd=function(){if(!a.ieCachedRange&&(b.selectionStart||0===b.selectionStart))d.start=b.selectionStart,d.end=b.selectionEnd;else if(e.selection){d.text=k.fixEolChars(b.value);var c=a.ieCachedRange||e.selection.createRange(),g=k.fixEolChars(c.text),i="\u0007"+g+"\u0007";c.text=i;var j=k.fixEolChars(b.value);c.moveStart("character",-i.length);c.text=g;d.start=j.indexOf("\u0007");d.end=j.lastIndexOf("\u0007")-1;if(i=d.text.length-k.fixEolChars(b.value).length){for(c.moveStart("character",-g.length);i--;)g+="\n",d.end+=1;c.text=g}a.ieCachedRange&&(d.scrollTop=a.ieCachedScrollTop);a.ieCachedRange=null;this.setInputAreaSelection()}};this.restore=function(){void 0!=d.text&&d.text!=b.value&&(b.value=d.text);this.setInputAreaSelection();b.scrollTop=d.scrollTop};this.getChunks=function(){var a=new v;a.before=k.fixEolChars(d.text.substring(0,d.start));a.startTag="";a.selection=k.fixEolChars(d.text.substring(d.start,d.end));a.endTag="";a.after=k.fixEolChars(d.text.substring(d.end));a.scrollTop=d.scrollTop;return a};this.setChunks=function(a){a.before+=a.startTag;a.after=a.endTag+a.after;this.start=a.before.length;this.end=a.before.length+a.selection.length;this.text=a.before+a.selection+a.after;this.scrollTop=a.scrollTop};this.init()}function H(a,c,d){var b,f,g,i=function(){var a=0;window.innerHeight?a=window.pageYOffset:e.documentElement&&e.documentElement.scrollTop?a=e.documentElement.scrollTop:e.body&&(a=e.body.scrollTop);return a},j=function(){if(c.preview){var b=c.input.value;if(!(b&&b==g)){g=b;var d=(new Date).getTime(),b=a.makeHtml(b);f=(new Date).getTime()-d;G(b)}}},n=function(){b&&(clearTimeout(b),b=void 0);var a=0,a=f;3E3<a&&(a=3E3);b=setTimeout(j,a)};this.refresh=function(a){a?(g="",j()):n()};this.processingTime=function(){return f};var h=!0,o=function(a){var b=c.preview,d=b.parentNode,f=b.nextSibling;d.removeChild(b);b.innerHTML=a;f?d.insertBefore(b,f):d.appendChild(b)},r=function(a){c.preview.innerHTML=a},l,m=function(a){if(l)return l(a);try{r(a),l=r}catch(c){l=o,l(a)}},G=function(a){var b=q.getTop(c.input)-i();c.preview&&(m(a),d());c.preview&&(c.preview.scrollTop=(c.preview.scrollHeight-c.preview.clientHeight)*(c.preview.scrollHeight<=c.preview.clientHeight?1:c.preview.scrollTop/(c.preview.scrollHeight-c.preview.clientHeight)));if(h)h=!1;else{var f=q.getTop(c.input)-i();u?setTimeout(function(){window.scrollBy(0,f-b)},0):window.scrollBy(0,f-b)}};(function(a,c){k.addEvent(a,"input",c);a.onpaste=c;a.ondrop=c;k.addEvent(a,"keypress",c);k.addEvent(a,"keydown",c)})(c.input,n);j();c.preview&&(c.preview.scrollTop=0)}function I(a,c,d,b,f,g){var i,j,n,h,o,r,l,m,q,t,v,D;function p(a){x.focus();if(a.textOp){d&&d.setCommandMode();var f=new A(c);if(!f)return;var h=f.getChunks(),g=function(){x.focus();h&&f.setChunks(h);f.restore();b.refresh()};a.textOp(h,g)||g()}a.execute&&a.execute(d)}function B(a,b){var d=a.getElementsByTagName("span")[0];if(b){if(d.style.backgroundPosition=a.XShift+" 0px",a.onmouseover=function(){d.style.backgroundPosition=this.XShift+" -40px"},a.onmouseout=function(){d.style.backgroundPosition=this.XShift+" 0px"},u&&(a.onmousedown=function(){e.activeElement&&e.activeElement!==c.input||(c.ieCachedRange=document.selection.createRange(),c.ieCachedScrollTop=c.input.scrollTop)}),!a.isHelp)a.onclick=function(){if(this.onmouseout)this.onmouseout();p(this);return false}}else d.style.backgroundPosition=a.XShift+" -20px",a.onmouseover=a.onmouseout=a.onclick=function(){}}function s(a){"string"===typeof a&&(a=f[a]);return function(){a.apply(f,arguments)}}function w(){d&&(B(i,d.canUndo()),B(j,d.canRedo()))}var x=c.input;D=v=t=q=m=l=r=o=h=n=j=i=void 0;(function(){var b=c.buttonBar,d=document.createElement("ul");d.id="wmd-button-row"+a;d.className="wmd-button-row";var d=b.appendChild(d),f=0,b=function(b,c,h,g){var e=document.createElement("li");e.className="wmd-button";e.style.left=f+"px";f+=25;var i=document.createElement("span");e.id=b+a;e.appendChild(i);e.title=c;e.XShift=h;g&&(e.textOp=g);B(e,!0);d.appendChild(e);return e},e=function(b){var c=document.createElement("li");c.className="wmd-spacer wmd-spacer"+b;c.id="wmd-spacer"+b+a;d.appendChild(c);f+=25};n=b("wmd-bold-button","Strong <strong> Ctrl+B","0px",s("doBold"));h=b("wmd-italic-button","Emphasis <em> Ctrl+I","-20px",s("doItalic"));e(1);o=b("wmd-link-button","Hyperlink <a> Ctrl+L","-40px",s(function(a,b){return this.doLinkOrImage(a,b,!1)}));r=b("wmd-quote-button","Blockquote <blockquote> Ctrl+Q","-60px",s("doBlockquote"));l=b("wmd-code-button","Code Sample <pre><code> Ctrl+K","-80px",s("doCode"));m=b("wmd-image-button","Image <img> Ctrl+G","-100px",s(function(a,b){return this.doLinkOrImage(a,b,!0)}));e(2);q=b("wmd-olist-button","Numbered List <ol> Ctrl+O","-120px",s(function(a,b){this.doList(a,b,!0)}));t=b("wmd-ulist-button","Bulleted List <ul> Ctrl+U","-140px",s(function(a,b){this.doList(a,b,!1)}));v=b("wmd-heading-button","Heading <h1>/<h2> Ctrl+H","-160px",s("doHeading"));D=b("wmd-hr-button","Horizontal Rule <hr> Ctrl+R","-180px",s("doHorizontalRule"));e(3);i=b("wmd-undo-button","Undo - Ctrl+Z","-200px",null);i.execute=function(a){a&&a.undo()};e=/win/.test(y.platform.toLowerCase())?"Redo - Ctrl+Y":"Redo - Ctrl+Shift+Z";j=b("wmd-redo-button",e,"-220px",null);j.execute=function(a){a&&a.redo()};g&&(b=document.createElement("li"),e=document.createElement("span"),b.appendChild(e),b.className="wmd-button wmd-help-button",b.id="wmd-help-button"+a,b.XShift="-240px",b.isHelp=!0,b.style.right="0px",b.title=g.title||J,b.onclick=g.handler,B(b,!0),d.appendChild(b));w()})();var z="keydown";C&&(z="keypress");k.addEvent(x,z,function(a){if((a.ctrlKey||a.metaKey)&&!a.altKey&&!a.shiftKey){switch(String.fromCharCode(a.charCode||a.keyCode).toLowerCase()){case "b":p(n);break;case "i":p(h);break;case "l":p(o);break;case "q":p(r);break;case "k":p(l);break;case "g":p(m);break;case "o":p(q);break;case "u":p(t);break;case "h":p(v);break;case "r":p(D);break;case "y":p(j);break;case "z":a.shiftKey?p(j):p(i);break;default:return}a.preventDefault&&a.preventDefault();window.event&&(window.event.returnValue=!1)}});k.addEvent(x,"keyup",function(a){if(a.shiftKey&&(!a.ctrlKey&&!a.metaKey)&&13===(a.charCode||a.keyCode))a={},a.textOp=s("doAutoindent"),p(a)});u&&k.addEvent(x,"keydown",function(a){if(27===a.keyCode)return!1});this.setUndoRedoButtonStates=w}function z(a){this.hooks=a}function K(a){return a.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(a,d,b){d=d.replace(/\?.*$/,function(a){return a.replace(/\+/g," ")});d=decodeURIComponent(d);d=encodeURI(d).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");d=d.replace(/\?.*$/,function(a){return a.replace(/\+/g,"%2b")});b&&(b=b.trim?b.trim():b.replace(/^\s*/,"").replace(/\s*$/,""),b=$.trim(b).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));return b?d+' "'+b+'"':d})}var k={},q={},t={},e=window.document,l=window.RegExp,y=window.navigator;u=/msie/.test(y.userAgent.toLowerCase());w=/msie 6/.test(y.userAgent.toLowerCase())||/msie 5/.test(y.userAgent.toLowerCase());C=/opera/.test(y.userAgent.toLowerCase());var J="Markdown Editing Help";Markdown.Editor=function(a,c,d){var c=c||"",b=this.hooks=new Markdown.HookCollection;b.addNoop("onPreviewRefresh");b.addNoop("postBlockquoteCreation");b.addFalse("insertImageDialog");this.getConverter=function(){return a};var f=this,g;this.run=function(){if(!g){g=new E(c);var i=new z(b),j=new H(a,g,function(){b.onPreviewRefresh()}),n,h;/\?noundo/.test(e.location.href)||(n=new F(function(){j.refresh();h&&h.setUndoRedoButtonStates()},g),this.textOperation=function(a){n.setCommandMode();a();f.refreshPreview()});h=new I(c,g,n,j,i,d);h.setUndoRedoButtonStates();(f.refreshPreview=function(){j.refresh(true)})()}}};v.prototype.findTags=function(a,c){var d=this,b;a&&(b=k.extendRegExp(a,"","$"),this.before=this.before.replace(b,function(a){d.startTag+=a;return""}),b=k.extendRegExp(a,"^",""),this.selection=this.selection.replace(b,function(a){d.startTag+=a;return""}));c&&(b=k.extendRegExp(c,"","$"),this.selection=this.selection.replace(b,function(a){d.endTag=a+d.endTag;return""}),b=k.extendRegExp(c,"^",""),this.after=this.after.replace(b,function(a){d.endTag=a+d.endTag;return""}))};v.prototype.trimWhitespace=function(a){var c,d=this;a?a=c="":(a=function(a){d.before+=a;return""},c=function(a){d.after=a+d.after;return""});this.selection=this.selection.replace(/^(\s*)/,a).replace(/(\s*)$/,c)};v.prototype.skipLines=function(a,c,d){void 0===a&&(a=1);void 0===c&&(c=1);a++;c++;var b,f;navigator.userAgent.match(/Chrome/)&&"X".match(/()./);this.selection=this.selection.replace(/(^\n*)/,"");this.startTag+=l.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag+=l.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before+=l.$1;this.endTag=this.endTag.replace(/(\n*$)/,"");this.after+=l.$1;if(this.before){for(b=f="";a--;)b+="\\n?",f+="\n";d&&(b="\\n*");this.before=this.before.replace(new l(b+"$",""),f)}if(this.after){for(b=f="";c--;)b+="\\n?",f+="\n";d&&(b="\\n*");this.after=this.after.replace(new l(b,""),f)}};k.isVisible=function(a){if(window.getComputedStyle)return"none"!==window.getComputedStyle(a,null).getPropertyValue("display");if(a.currentStyle)return"none"!==a.currentStyle.display};k.addEvent=function(a,c,d){a.attachEvent?a.attachEvent("on"+c,d):a.addEventListener(c,d,!1)};k.removeEvent=function(a,c,d){a.detachEvent?a.detachEvent("on"+c,d):a.removeEventListener(c,d,!1)};k.fixEolChars=function(a){a=a.replace(/\r\n/g,"\n");return a=a.replace(/\r/g,"\n")};k.extendRegExp=function(a,c,d){if(null===c||void 0===c)c="";if(null===d||void 0===d)d="";var a=a.toString(),b,a=a.replace(/\/([gim]*)$/,function(a,c){b=c;return""}),a=a.replace(/(^\/|\/$)/g,"");return new l(c+a+d,b)};q.getTop=function(a,c){var d=a.offsetTop;if(!c)for(;a=a.offsetParent;)d+=a.offsetTop;return d};q.getHeight=function(a){return a.offsetHeight||a.scrollHeight};q.getWidth=function(a){return a.offsetWidth||a.scrollWidth};q.getPageSize=function(){var a,c,d,b;self.innerHeight&&self.scrollMaxY?(a=e.body.scrollWidth,c=self.innerHeight+self.scrollMaxY):e.body.scrollHeight>e.body.offsetHeight?(a=e.body.scrollWidth,c=e.body.scrollHeight):(a=e.body.offsetWidth,c=e.body.offsetHeight);self.innerHeight?(d=self.innerWidth,b=self.innerHeight):e.documentElement&&e.documentElement.clientHeight?(d=e.documentElement.clientWidth,b=e.documentElement.clientHeight):e.body&&(d=e.body.clientWidth,b=e.body.clientHeight);a=Math.max(a,d);c=Math.max(c,b);return[a,c,d,b]};t.createBackground=function(){var a=e.createElement("div"),c=a.style;a.className="wmd-prompt-background";c.position="absolute";c.top="0";c.zIndex="1000";u?c.filter="alpha(opacity=50)":c.opacity="0.5";var d=q.getPageSize();c.height=d[1]+"px";u?(c.left=e.documentElement.scrollLeft,c.width=e.documentElement.clientWidth):(c.left="0",c.width="100%");e.body.appendChild(a);return a};t.prompt=function(a,c,d){var b,f;void 0===c&&(c="");var g=function(a){27===(a.charCode||a.keyCode)&&i(!0)},i=function(a){k.removeEvent(e.body,"keydown",g);var c=f.value;a?c=null:(c=c.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(c)||(c="http://"+c));b.parentNode.removeChild(b);d(c);return!1},j=function(){b=e.createElement("div");b.className="wmd-prompt-dialog";b.style.padding="10px;";b.style.position="fixed";b.style.width="400px";b.style.zIndex="1001";var d=e.createElement("div");d.innerHTML=a;d.style.padding="5px";b.appendChild(d);var d=e.createElement("form"),h=d.style;d.onsubmit=function(){return i(!1)};h.padding="0";h.margin="0";h.cssFloat="left";h.width="100%";h.textAlign="center";h.position="relative";b.appendChild(d);f=e.createElement("input");f.type="text";f.value=c;h=f.style;h.display="block";h.width="80%";h.marginLeft=h.marginRight="auto";d.appendChild(f);var o=e.createElement("input");o.type="button";o.onclick=function(){return i(!1)};o.value="OK";h=o.style;h.margin="10px";h.display="inline";h.width="7em";var j=e.createElement("input");j.type="button";j.onclick=function(){return i(!0)};j.value="Cancel";h=j.style;h.margin="10px";h.display="inline";h.width="7em";d.appendChild(o);d.appendChild(j);k.addEvent(e.body,"keydown",g);b.style.top="50%";b.style.left="50%";b.style.display="block";w&&(b.style.position="absolute",b.style.top=e.documentElement.scrollTop+200+"px",b.style.left="50%");e.body.appendChild(b);b.style.marginTop=-(q.getHeight(b)/2)+"px";b.style.marginLeft=-(q.getWidth(b)/2)+"px"};setTimeout(function(){j();var a=c.length;if(void 0!==f.selectionStart)f.selectionStart=0,f.selectionEnd=a;else if(f.createTextRange){var b=f.createTextRange();b.collapse(!1);b.moveStart("character",-a);b.moveEnd("character",a);b.select()}f.focus()},0)};var m=z.prototype;m.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";m.unwrap=function(a){var c=new l("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");a.selection=a.selection.replace(c,"$1 $2")};m.wrap=function(a,c){this.unwrap(a);var d=new l("(.{1,"+c+"})( +|$\\n?)","gm"),b=this;a.selection=a.selection.replace(d,function(a,c){return(new l("^"+b.prefixes,"")).test(a)?a:c+"\n"});a.selection=a.selection.replace(/\s+$/,"")};m.doBold=function(a,c){return this.doBorI(a,c,2,"strong text")};m.doItalic=function(a,c){return this.doBorI(a,c,1,"emphasized text")};m.doBorI=function(a,c,d,b){a.trimWhitespace();a.selection=a.selection.replace(/\n{2,}/g,"\n");var f=/(\**$)/.exec(a.before)[0],c=/(^\**)/.exec(a.after)[0],f=Math.min(f.length,c.length);f>=d&&(2!=f||1!=d)?(a.before=a.before.replace(l("[*]{"+d+"}$",""),""),a.after=a.after.replace(l("^[*]{"+d+"}",""),"")):!a.selection&&c?(a.after=a.after.replace(/^([*_]*)/,""),a.before=a.before.replace(/(\s?)$/,""),a.before=a.before+c+l.$1):(!a.selection&&!c&&(a.selection=b),d=1>=d?"*":"**",a.before+=d,a.after=d+a.after)};m.stripLinkDefs=function(a,c){return a=a.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(a,b,f,e,i){c[b]=a.replace(/\s*$/,"");return e?(c[b]=a.replace(/["(](.+?)[")]$/,""),e+i):""})};m.addLinkDef=function(a,c){var d=0,b={};a.before=this.stripLinkDefs(a.before,b);a.selection=this.stripLinkDefs(a.selection,b);a.after=this.stripLinkDefs(a.after,b);var f="",e=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,i=function(a){d++;a=a.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+d+"]:");f+="\n"+a},j=function(a,c,f,k,l,n){f=f.replace(e,j);return b[l]?(i(b[l]),c+f+k+d+n):a};a.before=a.before.replace(e,j);c?i(c):a.selection=a.selection.replace(e,j);var k=d;a.after=a.after.replace(e,j);a.after&&(a.after=a.after.replace(/\n*$/,""));a.after||(a.selection=a.selection.replace(/\n*$/,""));a.after+="\n\n"+f;return k};m.doLinkOrImage=function(a,c,d){a.trimWhitespace();a.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var b;if(1<a.endTag.length&&0<a.startTag.length)a.startTag=a.startTag.replace(/!?\[/,""),a.endTag="",this.addLinkDef(a,null);else if(a.selection=a.startTag+a.selection+a.endTag,a.startTag=a.endTag="",/\n\n/.test(a.selection))this.addLinkDef(a,null);else{var f=this,e=function(e){b.parentNode.removeChild(b);null!==e&&(a.selection=(" "+a.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1),e=" [999]: "+K(e),e=f.addLinkDef(a,e),a.startTag=d?"![":"[",a.endTag="]["+e+"]",a.selection||(a.selection=d?"enter image description here":"enter link description here"));c()};b=t.createBackground();d?this.hooks.insertImageDialog(e)||t.prompt("<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>","http://",e):t.prompt('<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',"http://",e);return!0}};m.doAutoindent=function(a){var c=!1;a.before=a.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");a.before=a.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");a.before=a.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");!a.selection&&!/^[ \t]*(?:\n|$)/.test(a.after)&&(a.after=a.after.replace(/^[^\n]*/,function(c){a.selection=c;return""}),c=!0);/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(a.before)&&this.doList&&this.doList(a);/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(a.before)&&this.doBlockquote&&this.doBlockquote(a);/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&this.doCode&&this.doCode(a);c&&(a.after=a.selection+a.after,a.selection="")};m.doBlockquote=function(a){a.selection=a.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(b,c,d,e){a.before+=c;a.after=e+a.after;return d});a.before=a.before.replace(/(>[ \t]*)$/,function(b,c){a.selection=c+a.selection;return""});a.selection=a.selection.replace(/^(\s|>)+$/,"");a.selection=a.selection||"Blockquote";var c="",d="",b;if(a.before){for(var e=a.before.replace(/\n$/,"").split("\n"),g=!1,i=0;i<e.length;i++){var j=!1;b=e[i];g=g&&0<b.length;/^>/.test(b)?(j=!0,!g&&1<b.length&&(g=!0)):j=/^[ \t]*$/.test(b)?!0:g;j?c+=b+"\n":(d+=c+b,c="\n")}/(^|\n)>/.test(c)||(d+=c,c="")}a.startTag=c;a.before=d;a.after&&(a.after=a.after.replace(/^\n?/,"\n"));a.after=a.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(b){a.endTag=b;return""});c=function(b){var c=b?"> ":"";if(a.startTag)a.startTag=a.startTag.replace(/\n((>|\s)*)\n$/,function(a,b){return"\n"+b.replace(/^[ ]{0,3}>?[ \t]*$/gm,c)+"\n"});if(a.endTag)a.endTag=a.endTag.replace(/^\n((>|\s)*)\n/,function(a,b){return"\n"+b.replace(/^[ ]{0,3}>?[ \t]*$/gm,c)+"\n"})};if(/^(?![ ]{0,3}>)/m.test(a.selection))this.wrap(a,70),a.selection=a.selection.replace(/^/gm,"> "),c(!0),a.skipLines();else if(a.selection=a.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(a),c(!1),!/^(\n|^)[ ]{0,3}>/.test(a.selection)&&a.startTag&&(a.startTag=a.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(a.selection)&&a.endTag)a.endTag=a.endTag.replace(/^\n{0,2}/,"\n\n");a.selection=this.hooks.postBlockquoteCreation(a.selection);/\n/.test(a.selection)||(a.selection=a.selection.replace(/^(> *)/,function(b,c){a.startTag=a.startTag+c;return""}))};m.doCode=function(a){var c=/\S[ ]*$/.test(a.before);if(!/^[ ]*\S/.test(a.after)&&!c||/\n/.test(a.selection)){a.before=a.before.replace(/[ ]{4}$/,function(b){a.selection=b+a.selection;return""});var d=c=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&(c=0);/^\n(\t|[ ]{4,})/.test(a.after)&&(d=0);a.skipLines(c,d);a.selection?/^[ ]{0,3}\S/m.test(a.selection)?/\n/.test(a.selection)?a.selection=a.selection.replace(/^/gm,"    "):a.before+="    ":a.selection=a.selection.replace(/^[ ]{4}/gm,""):(a.startTag="    ",a.selection="enter code here")}else a.trimWhitespace(),a.findTags(/`/,/`/),!a.startTag&&!a.endTag?(a.startTag=a.endTag="`",a.selection||(a.selection="enter code here")):a.endTag&&!a.startTag?(a.before+=a.endTag,a.endTag=""):a.startTag=a.endTag=""};m.doList=function(a,c,d){var c=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,b="-",e=1,g=function(){var a;d?(a=" "+e+". ",e++):a=" "+b+" ";return a},i=function(a){void 0===d&&(d=/^\s*\d/.test(a));return a=a.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(){return g()})};a.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);a.before&&(!/\n$/.test(a.before)&&!/^\n/.test(a.startTag))&&(a.before+=a.startTag,a.startTag="");if(a.startTag){var j=/\d+[.]/.test(a.startTag);a.startTag="";a.selection=a.selection.replace(/\n[ ]{4}/g,"\n");this.unwrap(a);a.skipLines();j&&(a.after=a.after.replace(c,i));if(d==j)return}var k=1;a.before=a.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(a){if(/^\s*([*+-])/.test(a))b=l.$1;k=/[^\n]\n\n[^\n]/.test(a)?1:0;return i(a)});a.selection||(a.selection="List item");var j=g(),h=1;a.after=a.after.replace(c,function(a){h=/[^\n]\n\n[^\n]/.test(a)?1:0;return i(a)});a.trimWhitespace(!0);a.skipLines(k,h,!0);a.startTag=j;c=j.replace(/./g," ");this.wrap(a,72-c.length);a.selection=a.selection.replace(/\n/g,"\n"+c)};m.doHeading=function(a){a.selection=a.selection.replace(/\s+/g," ");a.selection=a.selection.replace(/(^\s+|\s+$)/g,"");if(a.selection){var c=0;a.findTags(/#+[ ]*/,/[ ]*#+/);/#+/.test(a.startTag)&&(c=l.lastMatch.length);a.startTag=a.endTag="";a.findTags(null,/\s?(-+|=+)/);/=+/.test(a.endTag)&&(c=1);/-+/.test(a.endTag)&&(c=2);a.startTag=a.endTag="";a.skipLines(1,1);c=0==c?2:c-1;if(0<c){var c=2<=c?"-":"=",d=a.selection.length;72<d&&(d=72);for(a.endTag="\n";d--;)a.endTag+=c}}else a.startTag="## ",a.selection="Heading",a.endTag=" ##"};m.doHorizontalRule=function(a){a.startTag="----------\n";a.selection="";a.skipLines(2,1,!0)}})();
